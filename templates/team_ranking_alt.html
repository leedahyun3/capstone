<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>팀 순위</title>
  <style>
    body { margin:0; font-family: -apple-system, BlinkMacSystemFont, "Noto Sans KR", Arial, sans-serif; }
    .wrap { padding: 8px 10px; }
    h3 { margin: 8px 0 12px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { border: 1px solid #e6e6e9; padding: 6px 8px; font-size: 14px; text-align: center; }
    th { background: #f3f4f6; }
    .meta { font-size: 12px; color: #666; margin-bottom: 6px; }
    .teamcell { display:flex; align-items:center; gap:8px; justify-content:center; }
    .logo { width:28px; height:28px; object-fit:contain; border-radius:4px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h3>팀 순위</h3>
    {% if updated_at %}<div class="meta">업데이트: {{ updated_at }}</div>{% endif %}

    {% if rankings and rankings|length > 0 %}
      {% set cols = rankings[0].keys() %}
      <table>
        <thead>
          <tr>
            {% for c in cols %}<th>{{ c }}</th>{% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for r in rankings %}
            <tr>
              {% for c in cols %}
                <td>
                  {% if c == 'logo' and r.get('logo') %}
                    <!-- URL 문자열 대신 이미지로 표시 (핫링크 방지용 proxy 사용) -->
                    <img class="logo"
                         src="{{ url_for('proxy_logo') }}?url={{ r['logo']|urlencode }}"
                         alt="{{ r.get('team_name','') }} 로고"
                         loading="lazy">
                  {% elif c == 'team_name' %}
                    <div class="teamcell">
                      {% if r.get('logo') %}
                        <img class="logo"
                             src="{{ url_for('proxy_logo') }}?url={{ r['logo']|urlencode }}"
                             alt="{{ r.get('team_name','') }} 로고"
                             loading="lazy">
                      {% endif %}
                      <span>{{ r.get('team_name','') }}</span>
                    </div>
                  {% else %}
                    {{ r.get(c, '') }}
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div>데이터가 아직 없습니다. 잠시 후 새로고침 해주세요.</div>
    {% endif %}
  </div>
</body>
</html>
